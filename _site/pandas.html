<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Introduction to Data Science - Using Python in the newsroom</title>
    <meta name="description" content="Introduction to Data Science with Python" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="./assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="./assets/css/main.css" />

</head>
<body class="post-template page-template">

    <nav class="main-nav clearfix">
  <a class="back-button icon-arrow-left" href="/">Home</a>
</nav>


<main class="content" role="main">
  <article class="post">

    <h1 class="post-title">Pandas, The First Look</h1>

    <section class="post-content">
      <p>Now that we&#39;re comfortable with creating our coding environment and dabbling with the iPython notebook, it&#39;s time to dive into <a href="http://pandas.pydata.org/">pandas</a>, the Python library created explicitly for data analysis. </p>

<p>First, we&#39;ll import pandas, creating the local namespace of &quot;pd&quot;.</p>

<p><code>import pandas as pd</code></p>

<p>Today, we&#39;re going to work with a fairly large text file of <a href="http://www.state.nj.us/transportation/refdata/accident/">car accident data</a> from the New Jersey Department of Transportation. This file contains reports from accidents in the Garden State between 2008 and 2013. The data, originally filed in handwritten reports by state troopers and then typed into a fixed-width database by clerks, is both large and very messy. </p>

<p>Our analysis today will not be comprehensive or particularly accurate, but working with 1.7 million rows of dirty data are what pandas is made for.</p>

<p>The first thing we have to do is ingest our data from a source into a pandas DataFrame object. Think of a DataFrame (similar to the R Data Frame) as a virtual spreadsheet. It has columns with unique names and rows with unique row numbers (or Index). You can read in data from <a href="http://pandas.pydata.org/pandas-docs/dev/io.html">many kinds of sources</a>: json, Excel, html, sql databases or many others. Today, we&#39;re going to work <a href="http://pandas.pydata.org/pandas-docs/dev/generated/pandas.io.parsers.read_csv.html">with a CSV</a>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">datafile = &quot;njaccidents.csv&quot;
accframe = pd.read_csv(datafile)
</code></pre></div>
<p>Let&#39;s look at our DataFrame. Look familliar? It&#39;s a table!</p>

<p><img src="assets/images/pandashot1.png" alt=""></p>

<p>Let&#39;s see what we have here. Let&#39;s make a list of the columns we have to work with. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">In [5]: accframe.columns
Out [5]: Index([u&#39;case code&#39;, u&#39;County Name&#39;, u&#39;Municipality Name&#39;, u&#39;Crash Date&#39;, u&#39;Crash Day Of Week&#39;, u&#39;Crash Time&#39;, u&#39;Police Dept Code&#39;, u&#39;Police Department&#39;, u&#39;Police Station&#39;, u&#39;Total Killed&#39;, u&#39;Total Injured&#39;, u&#39;Pedestrians Killed&#39;, u&#39;Pedestrians Injured&#39;, u&#39;Severity&#39;, u&#39;Intersection&#39;, u&#39;Alcohol Involved&#39;, u&#39;HazMat Involved&#39;, u&#39;Crash Type Code&#39;, u&#39;Total Vehicles Involved&#39;, u&#39;Crash Location&#39;, u&#39;Location Direction&#39;, u&#39;Route&#39;, u&#39;Route Suffix&#39;, u&#39;SRI (Std Rte Identifier)&#39;, u&#39;MilePost&#39;, u&#39;Road System&#39;, u&#39;Road Character&#39;, u&#39;Road Surface Type&#39;, u&#39;Surface Condition&#39;, u&#39;Light Condition&#39;, u&#39;Environmental Condition&#39;, u&#39;Road Divided By&#39;, u&#39;Temporary Traffic Control Zone&#39;, u&#39;Distance To Cross Street&#39;, u&#39;Unit Of Measurement&#39;, u&#39;Directn From Cross Street&#39;, u&#39;Cross Street Name&#39;, u&#39;Is Ramp&#39;, u&#39;Ramp To/From Route Name&#39;, u&#39;Ramp To/From Route Direction&#39;, u&#39;Posted Speed&#39;, u&#39;Posted Speed Cross Street&#39;, u&#39;Latitude&#39;, u&#39;Longitude&#39;, u&#39;Cell Phone In Use Flag&#39;, u&#39;Other Property Damage&#39;, u&#39;Reporting Badge No.&#39;], dtype=&#39;object&#39;)
</code></pre></div>
<p>To get a quick overview of what kind of data, try the describe method. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe.describe()
</code></pre></div>
<p>In earlier versions of pandas (&lt;15), <code>describe()</code> gives you the summary statistics for the numeric columns. In new versions of pandas, using the <code>include=&#39;all&#39;</code> keyword will summarize all the columns.</p>

<p><img src="assets/images/pandashot2.png" alt=""></p>

<p>For categorical columns, you&#39;ll get the number of unique values and the most frequent, like so: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe[&#39; Severity&#39;].describe()
</code></pre></div>
<p>Returns: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">count     1707841
unique          3
top             P
freq      1326626
dtype: object
</code></pre></div>
<p>So say you want to select a single column. You can do this in one of two ways. If the column name is a string with spaces, you can use dot notation. <code>accframe.Severity</code>, for instance. Otherwise, you use a similar syntax to what we&#39;re used to with dicts, like this: <code>accframe[&#39;County Name&#39;]</code>. If you want to grab more than one column, give it a list of column names. If you wanted to see the &#39;Cell Phone In Use Flag&#39; column, or the &#39;County Name&#39; column, what would you do?</p>

<p>Let&#39;s take a look at cleaning messy data in columns. Why does this yield an empty DataFrame?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe[accframe[&#39;County Name&#39;]==&#39;PASSAIC&#39;]
</code></pre></div>
<p>This is because with some digging, <code>accframe[accframe[&#39;County Name&#39;].str.contains(&#39;PASSAIC&#39;)]</code>, you&#39;ll notice that the &#39;County Name&#39; column includes a ton of trailing whitespace: <code>&#39;PASSAIC     &#39;</code>.</p>

<p>You can use the map function to map the strip method on every string in the column.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe[&#39;County Name&#39;]=accframe[&#39;County Name&#39;].map(str.strip)
</code></pre></div>
<p>Why don&#39;t you do the same for the &#39;Municipality Name&#39; and &#39;Police Department&#39; columns?</p>

<p>Now that our &#39;County Name&#39; field is cleaned, we can filter by it, if we wanted to, getting a few of the DataFrame that would only show the rows with accidents that happened in Passaic County. unty.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe[accframe[&#39;County Name&#39;]==&#39;PASSAIC&#39;]
</code></pre></div>
<p>Let&#39;s do a couple of more things with this. </p>

<p>What do we see when we look at the unique values in the &#39;Police Dept Code&#39; column?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">accframe[&#39;Police Dept Code&#39;].unique()
array([&#39;01&#39;, &#39;99&#39;, &#39;  &#39;, &#39;02&#39;, &#39;03&#39;, &#39;04&#39;, 1, 99, 2, 3, 4], dtype=object)
&#39;&#39;&#39;

If we look at just the departments with 99 as their code, we&#39;ll see they&#39;re not unique, of course. 
</code></pre></div>
<p>accframe[[&#39;Police Dept Code&#39;, &#39;Police Department&#39;]][accframe[&#39;Police Dept Code&#39;]==99]
```</p>

<p>Because some of our department codes start with 0, we should probably make all of these strings rather than ints.
<code>
accframe[&#39;Police Dept Code&#39;]=accframe[&#39;Police Dept Code&#39;].astype(str)
</code></p>

<p>But we still have some empty fields with two spaces in the string, so let&#39;s fill those with the word &quot;Unknown&quot;
<code>
accframe[&#39;Police Dept Code&#39;][accframe[&#39;Police Dept Code&#39;]==&#39;  &#39;]=&#39;Unknown&#39;
</code></p>

<p>Finally, for now, let&#39;s make smaller DataFrames of just the columns that we plan to use for this analysis. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">myframe = accframe[[&#39;County Name&#39;, &#39;Municipality Name&#39;, &#39;Crash Date&#39;, &#39;Crash Day Of Week&#39;, &#39;Crash Time&#39;, &#39;Total Killed&#39;, &#39;Total Injured&#39;, &#39;Pedestrians Killed&#39;, &#39;Pedestrians Injured&#39;, &#39;Total Vehicles Involved&#39;, &#39;Crash Type Code&#39;, &#39;Alcohol Involved&#39;, &#39;Environmental Condition&#39;, &#39;Light Condition&#39;, &#39;Cell Phone In Use Flag&#39;]]
</code></pre></div>
<p>Finally, we can hand <code>myframe</code> to the next exercise for aggregating, but we might want to save it for later. Let&#39;s write it out to a csv, while we&#39;re thinking about it.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">myframe.to_csv(&#39;smallertab.csv&#39;)
</code></pre></div>
<p>Now, we&#39;re ready to start <a href="./deeper.html">digging deeper</a>.</p>

    </section>
  </article>
</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="/">Introduction to Data Science</a> &copy;
               &bull; All rights reserved.
        
      </section>
      <section class="poweredby">Made with Jekyll using
        <a href="http://github.com/rosario/kasper">Kasper theme</a>
      </section>
    </footer>

    <script type="text/javascript" src="/assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>
</body>
</html>
